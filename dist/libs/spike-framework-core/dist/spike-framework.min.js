function _spike_jquery_set_setFunction(selector,value){var elementType=selector.prop("tagName");elementType||(elementType=selector.prop("nodeName")),elementType=elementType.toLowerCase(),"label"==elementType||"div"==elementType||"span"==elementType||"button"==elementType||"p"==elementType||elementType.indexOf("h")>-1?selector.html(value.toString()):"img"==elementType?selector.attr("src",value):selector.is(":checkbox")?1==value||1==parseInt(value)?selector.prop("checked",!0):selector.prop("checked",!1):"a"==elementType?selector.attr("href",value):selector.val(value)}function _spike_jquery_set_populateFunction(selector,data,prefix,selectors){prefix||(prefix=""),selectors||(selectors=Array.prototype.slice.call(selector[0].querySelectorAll("[id]")).concat(Array.prototype.slice.call(selector[0].querySelectorAll("["+app.__attributes.SET_VAL+"]")))),Object.keys(data).map(function(itemName){for(var reducedSelectors=[],i=0;i<selectors.length;i++)selectors[i].id==prefix+itemName||$(selectors[i]).attr(app.__attributes.SET_VAL)==prefix+itemName?$(selectors[i]).set(data[itemName]):reducedSelectors.push(selectors[i]);app.util.System.isObject(data[itemName])&&_spike_jquery_set_populateFunction(selector,data[itemName],itemName+".",reducedSelectors)})}var app={__starting:!0,__attributes:{TRANSLATION:"spike-translation",VIEW:"spike-view",MODALS:"spike-modals",SET_VAL:"spike-val",TEMPLATE_INCLUDE:"@template"},__globalTemplates:"_spike_templates",version:"1.8",currentController:null,getCurrentController:function(){return app.currentController||app.config.mainController},ctx:null,mCtx:{},com:{},online:!1,obj:function(jsObject){app.config.showObj&&console.log(jsObject)},log:function(logMessage,logData){app.config.showLog&&app.__print(logMessage,logData,"LOG")},error:function(errorMessage,errorData){app.config.showError&&app.__print(errorMessage,errorData,"ERROR")},debug:function(debugMessage,debugData){app.config.showDebug&&app.__print(debugMessage,debugData,"DEBUG")},warn:function(warnMessage,warnData){app.config.showWarn&&app.__print(warnMessage,warnData,"WARN")},ok:function(okMessage,okData){app.config.showOk&&app.__print(okMessage,okData,"OK")},__print:function(message,data,type){"string"!=typeof message&&(message=JSON.stringify(message)),data&&(message=app.util.System.bindStringParams(message,data));var color="";switch(type){case"LOG":color="blue";break;case"ERROR":color="red";break;case"DEBUG":color="gray";break;case"WARN":color="orange";break;case"OK":color="green";break;default:color="black"}if("ERROR"==type){for(var stack=(new Error).stack,lineAccessingLogger=stack.split("\n"),stackStr="",i=0;i<lineAccessingLogger.length;i++)stackStr+=i==lineAccessingLogger.length-1?"\n ERROR HERE: "+lineAccessingLogger[i]:"\n"+lineAccessingLogger[i];console.log("%c"+app.util.System.currentDateLog()+" Spike Framework: "+message+" stacktrace: ","color: "+color),console.log("%c"+stackStr,"color: "+color)}else console.log("%c"+app.util.System.currentDateLog()+" Spike Framework: "+message,"color: "+color)}};app.system={__messages:{ENUMERATOR_ALREADY_REGISTRED:"Enumerator {0{ is already registered",UTIL_ALREADY_REGISTRED:"Util {0} is already registred",SERVICE_ALREADY_REGISTRED:"Service {0} is already registred",INHERIT_ABSTRACT_NOT_EXIST:"Inheriting abstracts into {0} - some abstracts not exists",ABSTRACT_ALREADY_REGISTRED:"Abstract {0} is already registred",INTERCEPTOR_ALREADY_REGISTRED:"Interceptor {0} is already registred",COMPONENT_NOT_DECLARED_IN_COMPONENTS:'Component {0} is not declared in "components" property',COMPONENT_NOT_DECLARED_IN_VIEW:"Component {0} is not declared in parent view",PARITAL_INCLUDE_NOT_DEFINED:"Try including not existing partial",PARITAL_SELECTOR_NOT_DEFINED:"Passed selector for Partial {0} is not defined",REDIRECT_NO_PATH:"Try redirect to path but path argument is not defined",TRANSLATION_PARSING:"Translation parsing error for language {0}",LISTER_DATA_NOT_ARRAY:"Lister input data must be an Array object, error evaluating lister named {0}",LISTER_ELEMENT_EMPTY:"Lister element {0} is empty",TEMPLATE_NOT_FOUND_ERROR:"Template named {0} not found",INITIAL_VIEW_ERROR:"No initial view with name: {0}",WEBSQL_SUPPORT:"No WebSQL support in this browser",PATH_DEFINITION:"Path URI and Path object cannot be empty",PATH_ALREADY_EXIST:"Path {0} is already defined",PATH_PATTERN_ALREADY_EXIST:"Path {0} is already defined. Pattern {1} is duplicated",MODULE_NOT_EXIST:"Try rendering not existing module",RESTRICTED_NAME:"Name {0} is restricted in usage in application",TRANSLATION_NOT_EXIST:"No defined language: {0}",TRANSLATION_LOAD_WARN:"Translation file for language: {0} cannot be downloaded, status: {1}",OUTSIDE_CONTEXT_COMPONENT_NOT_FOUND:'Component {0} outside "spike-view" is not defined and cannot be rendered',OUTSIDE_CONTEXT_COMPONENT_NOT_GLOBAL:'Component {0} outside "spike-view" cannot be rendered because is not GLOBAL',OUTSIDE_CONTEXT_COMPONENT_NO_NAME:"One of global component has not defined name"},__filterRestrictedNames:function(name){var isInvalid=!1;switch(name){case"list":isInvalid=!0;break;case"add":isInvalid=!0;break;case"register":isInvalid=!0;break;case"get":isInvalid=!0;break;case"extend":isInvalid=!0;break;case"inherits":isInvalid=!0}isInvalid&&this.__throwError(this.__messages.RESTRICTED_NAME,[name])},__cacheUsageCounter:0,__selectorsCache:{},__clearSelectorsCache:function(){app.system.__selectorsCache={}},__clearSelectorInCache:function(selectorId){app.system.__selectorsCache[selectorId]&&(app.system.__selectorsCache[selectorId]=null)},__createSelectors:function(templateHtml){var selectors={},idList=app.util.System.findStringBetween(templateHtml,'id="','"'),nameList=app.util.System.findStringBetween(templateHtml,'name="','"');return selectors.names={},$.each(nameList,function(i,name){selectors.names[name]=function(){return $('[name="'+name+'"]')}}),$.each(idList,function(i,id){var newId=id+"-"+app.util.System.hash();selectors[id]=function(eventsToBind){var selector=app.system.__selectorsCache[newId];return selector?app.system.__cacheUsageCounter++:(selector=$("#"+newId),selector.plainId=newId,app.system.__selectorsCache[newId]=selector),$.each(eventsToBind,function(eventName,eventCallback){"click"==eventName?selector.click(eventCallback):"change"==eventName?selector.change(eventCallback):selector.on(eventName,eventCallback)}),selector},templateHtml=templateHtml.replace('id="'+id+'"','id="'+newId+'"')}),{html:templateHtml,selectors:selectors}},__onRenderEvent:function(){app.events.onRender&&app.events.onRender()},__throwError:function(errorMessage,errorMessageBinding){throw new Error("Spike Framework: "+app.util.System.bindStringParams(errorMessage,errorMessageBinding))},__throwWarn:function(warnMessage,warnMessageBinding){app.warn("Spike Framework: "+app.util.System.bindStringParams(warnMessage,warnMessageBinding))},__renderModal:function(modalObject,modalInitialData,afterRenderCallback){app.debug("Invoke system.__renderModal with params: {0} {1} {2}",[modalObject,modalInitialData,afterRenderCallback]),app.log("Rendering modal {0}",[modalObject.__name]),1==modalObject.checkNetwork&&app.__cordova.checkNetwork(),void 0==modalInitialData&&(modalInitialData=null),modalObject.__render(modalInitialData),app.system.__onRenderEvent(),afterRenderCallback&&afterRenderCallback()},__renderController:function(controllerObject,controllerInitialData,afterRenderCallback){app.debug("Invoke system._renderController with params: {0} {1} {2}",[controllerObject,controllerInitialData,afterRenderCallback]),app.log("Rendering controller {0}",[controllerObject.__name]),$(window).scrollTop(0),app.modal.invalidateAll(),1==controllerObject.checkNetwork&&app.__cordova.checkNetwork(),void 0==controllerInitialData&&(controllerInitialData=null),app.system.__clearSelectorsCache(),controllerObject.__render(controllerInitialData),app.system.__onRenderEvent(),afterRenderCallback&&afterRenderCallback(),app.ok("Selectors cache usage during app lifecycle: "+app.system.__cacheUsageCounter)},render:function(moduleObject,moduleInitialData,afterRenderCallback){moduleObject||app.system.__throwError(app.system.__messages.MODULE_NOT_EXIST),"CONTROLLER"==moduleObject.__type?app.system.__renderController(moduleObject,moduleInitialData,afterRenderCallback):"MODAL"==moduleObject.__type&&app.system.__renderModal(moduleObject,moduleInitialData,afterRenderCallback)},getView:function(){return $("["+app.__attributes.VIEW+"]")},__initialView:function(){app.debug("Running system.initialView");var viewSelector=app.system.getView();if(app.config.initialView&&app.config.initialView.trim().length>0)try{window[app.__globalTemplates][app.config.initialView];viewSelector.html(templateHTML)}catch(err){app.system.__throwError(app.system.__messages.INITIAL_VIEW_ERROR,[app.config.initialView])}},init:function(callBack){app.debug("Invoke system.init with params: {0}",[callBack]),app.ok("System initializing..."),app.debug("veryfing views"),app.modal.__verifyView(),app.controller.__verifyView(),app.warn("jQuery version: {0}",[jQuery.fn.jquery]),app.warn("Spike version: {0}",[app.version]),$(document).ready(function(){app.component.__initGlobalComponents(),app.router.__registerRouter(),app.system.__initialView(),app.__cordova.__initializeCordova(function(){app.ok("Cordova initialized with app.config.mobileRun = {0}",[app.config.mobileRun]),app.config.mobileRun?app.__cordova.__deviceReadyCallBack=function(){app.__database.__createDB(callBack)}:(app.events.onDeviceReady(),app.__database.__createDB(callBack))})})},changeLanguage:function(langCode){app.debug("Invoke system.changeLanguage with params: {0}",[langCode]),app.config.lang=langCode,app.message.__translate()},exit:function(){app.debug("Invoke system.exit"),app.config.mobileRun?navigator.app.exitApp():(console.warn("EXIT APP"),app.modal.invalidateAll())},disableCache:function(){$.ajaxSetup({cache:!1})},__mainRender:function(callBack){app.debug("Invoke system.__mainRender with params: {0}",[callBack]),app.events.onReady&&app.events.onReady(),app.ok("Spike application ready to work..."),app.debug("Try to invoke system.render with controller: {0}",[app.config.mainController]),app.config.routingEnabled||(app.system.render(app.controller[app.config.mainController],null,callBack),app.__starting=!1)},__noSupport:function(){var isChromium=window.chrome,winNav=window.navigator,isOpera=(winNav.vendor,winNav.userAgent.indexOf("OPR")>-1),isIOSChrome=(winNav.userAgent.indexOf("Edge")>-1,winNav.userAgent.match("CriOS"));isIOSChrome||isChromium||isOpera||($("body").append('<div class="no-browser">Sorry,</br>you can test mobile app only in Chrome</div>'),app.system.__throwError(app.system.__messages.WEBSQL_SUPPORT))},__bindEvents:function(rootSelector){rootSelector.find("[spike-event]").each(function(i,element){element=$(element);var eventName=element.attr("spike-event");element.removeAttr("spike-event");var eventFunctionBody=element.attr("spike-event-"+eventName);element.off().on(eventName,Function(eventFunctionBody))})},__replacePlainTemplates:function(templateHtml){for(var templatesIncludes=app.util.System.findStringBetween(templateHtml,app.__attributes.TEMPLATE_INCLUDE+"\\(","\\)"),i=0;i<templatesIncludes.length;i++)templatesIncludes[i]=templatesIncludes[i].replace(app.__attributes.TEMPLATE_INCLUDE+"(","").replace(")",""),templatesIncludes[i]={templateFullName:app.system.__getStaticTemplateName(templatesIncludes[i]),templateInclude:templatesIncludes[i]};for(var i=0;i<templatesIncludes.length;i++)window[app.__globalTemplates][templatesIncludes[i].templateFullName]&&(templateHtml=templateHtml.split(app.__attributes.TEMPLATE_INCLUDE+"("+templatesIncludes[i].templateInclude+")").join(window[app.__globalTemplates][templatesIncludes[i].templateFullName]));return templateHtml},__getStaticTemplateName:function(templateName){return"@template/"+templateName}},Function.prototype.bind||(Function.prototype.bind=function(oThis){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(fNOP.prototype=this.prototype),fBound.prototype=new fNOP,fBound}),app.router={__events:{},__otherwiseReplacement:"!",__pathParamReplacement:"__var__",__endpoints:{},__getRouterFactory:function(){return{path:app.router.__pathFunction,other:app.router.__otherFunction}},create:function(){return app.router.__getRouterFactory()},__otherFunction:function(pathObject){return app.router.__pathFunction(app.router.__otherwiseReplacement,pathObject)},__pathFunction:function(pathValue,pathObject){return(app.util.System.isEmpty(pathValue)||app.util.System.isNull(pathObject))&&app.system.__throwError(app.system.__messages.PATH_DEFINITION),app.router.__registerPath(pathValue,pathObject.controller,pathObject.routingParams,pathObject.onRoute),app.router.__getRouterFactory()},__registerPath:function(pathValue,pathController,routingParams,onRouteEvent){app.router.__endpoints[pathValue]&&app.system.__throwError(app.system.__messages.PATH_ALREADY_EXIST,[pathValue]);var pathPattern=app.router.__createPathPattern(pathValue);app.router.__pathPatternExist(pathPattern)&&app.system.__throwError(app.system.__messages.PATH_PATTERN_ALREADY_EXIST,[pathValue,pathPattern.join("").split(app.router.__pathParamReplacement).join("/PATH_PARAM")]),app.router.__endpoints[pathValue]={__pathValue:pathValue,controller:pathController,routingParams:routingParams,onRouteEvent:onRouteEvent,__pathPattern:pathPattern}},__pathPatternExist:function(pathPattern){for(pathValue in app.router.__endpoints)if(app.router.__endpoints[pathValue].__pathPattern.pattern.join("")==pathPattern.pattern.join(""))return!0;return!1},__createPathPattern:function(pathValue){for(var pathPattern={pattern:[],pathParams:[]},splitted=pathValue.substring(0,pathValue.indexOf("?")>-1?pathValue.indexOf("?"):pathValue.length).split("/"),i=0;i<splitted.length;i++)splitted[i].indexOf(":")>-1?(pathPattern.pathParams.push(splitted[i].replace(":","")),pathPattern.pattern.push(app.router.__pathParamReplacement)):splitted[i].trim().length>0&&pathPattern.pattern.push(splitted[i]);return pathPattern},__registerRouter:function(){app.config.routingEnabled&&("#/"!==window.location.hash.substring(0,2)&&(window.location.hash="#/"),app.router.__renderCurrentView(),app.__starting=!1,$(window).bind("hashchange",function(e){app.router.__renderCurrentView(),app.router.__fireRouteEvents(e)}))},__fireRouteEvents:function(e){var currentRoute=app.router.getCurrentRoute();$.each(app.router.__events,function(eventName,eventFunction){eventFunction&&eventFunction(e,currentRoute,app.currentController)})},onRouteChange:function(eventName,eventFunction){app.router.__events[eventName]&&app.system.__throwWarn(app.system.__messages.ROUTE_EVENT_ALREADY_REGISTRED,[eventName]),app.router.__events[eventName]=eventFunction},offRouteChange:function(eventName){app.router.__events[eventName]&&(app.router.__events[eventName]=null)},__checkPathIntegrity:function(hashPattern,endpointPattern){for(var i=0;i<endpointPattern.pattern.length;i++)if(endpointPattern.pattern[i]!==app.router.__pathParamReplacement&&endpointPattern.pattern[i]!==hashPattern.pattern[i])return!1;return!0},__getURLParams:function(){var params={};return window.location.href.indexOf("?")>-1&&window.location.href.substring(window.location.href.indexOf("?"),window.location.href.length).replace(/[?&]+([^=&]+)=([^&]*)/gi,function(str,key,value){params[key]=app.util.System.tryParseNumber(value)}),params},__getPathData:function(hashPattern,endpointPattern){for(var urlParams=app.router.__getURLParams(),pathParams={},pathParamsIndex=0,i=0;i<endpointPattern.pattern.length;i++)endpointPattern.pattern[i]==app.router.__pathParamReplacement&&(pathParams[endpointPattern.pathParams[pathParamsIndex]]=app.util.System.tryParseNumber(hashPattern.pattern[i]),pathParamsIndex++);return{urlParams:urlParams,pathParams:pathParams}},__getCurrentView:function(){var currentEndpointObject=app.router.__getCurrentViewData(),currentEndpointData=currentEndpointObject.data,currentEndpoint=currentEndpointObject.endpoint;return null==currentEndpointData&&app.router.__endpoints[app.router.__otherwiseReplacement]?currentEndpointData={__controller:app.router.__endpoints[app.router.__otherwiseReplacement].controller,routingParams:app.router.__endpoints[app.router.__otherwiseReplacement].routingParams,__onRouteEvent:app.router.__endpoints[app.router.__otherwiseReplacement].onRouteEvent}:(currentEndpointData.__controller=currentEndpoint.controller,currentEndpointData.routingParams=currentEndpoint.routingParams,currentEndpointData.__onRouteEvent=currentEndpoint.onRouteEvent),currentEndpointData},__getCurrentViewData:function(){var hash=window.location.hash.replace(/^#\//,""),hashPattern=app.router.__createPathPattern(hash);for(var pathValue in app.router.__endpoints)if(app.router.__endpoints[pathValue].__pathPattern.pattern.length==hashPattern.pattern.length&&app.router.__checkPathIntegrity(hashPattern,app.router.__endpoints[pathValue].__pathPattern)){var currentEndpoint=app.router.__endpoints[pathValue],currentEndpointData=app.router.__getPathData(hashPattern,app.router.__endpoints[pathValue].__pathPattern);return{endpoint:currentEndpoint,data:currentEndpointData}}return{endpoint:null,data:null}},setPathParams:function(pathParams){var currentViewData=app.router.__getCurrentViewData();for(var pathParam in pathParams)currentViewData.data.pathParams[pathParam]&&!app.util.System.isNull(pathParams[pathParam])&&(currentViewData.data.pathParams[pathParam]=pathParams[pathParam]);app.router.__redirectToView(currentViewData.endpoint.__pathValue,currentViewData.data.pathParams,currentViewData.data.urlParams)},setURLParams:function(urlParams){var currentViewData=app.router.__getCurrentViewData();for(var urlParam in urlParams)currentViewData.data.urlParams[urlParam]&&!app.util.System.isNull(urlParams[urlParam])&&(currentViewData.data.urlParams[urlParam]=urlParams[urlParam]);app.router.__redirectToView(currentViewData.endpoint.__pathValue,currentViewData.data.pathParams,currentViewData.data.urlParams)},getCurrentRoute:function(){return window.location.hash.replace("#/","")},__redirectToView:function(path,pathParams,urlParams){path||app.system.__throwError(app.system.__messages.REDIRECT_NO_PATH),path=path.replace("#/","/"),"/"!==path[0]&&(path="/"+path),path=app.util.System.preparePathDottedParams(path,pathParams),path=app.util.System.prepareUrlParams(path,urlParams),window.location.hash=path},__renderCurrentView:function(){var currentEndpointData=app.router.__getCurrentView();app.log("current view to render {0}",[currentEndpointData]),app.system.render(app.controller[currentEndpointData.__controller],currentEndpointData,currentEndpointData.__onRouteEvent)},redirect:function(path,pathParams,urlParams){app.router.__redirectToView(path,pathParams,urlParams)},createLink:function(path){return"/"==path.substring(0,1)?path="#"+path:"#"!==path.substring(0,1)&&(path="#/"+path),path},back:function(){window.history.back()}},app.config={transitions:!1,transitionAnimation:function(oldViewSelector,newViewSelector,appStartup,fromController,toController,complete){appStartup?(app.log("Transition disabled for app startup"),complete()):(app.log("Default transition from "+fromController+" to "+toController),oldViewSelector.css("z-index","2000").css("position","fixed").css("min-height",$(window).height()+"px").css("background","#fff").css("box-shadow","2px 2px 8px #ccc").css("border","1px solid black").css("width","100%").show(),oldViewSelector.stop().animate({right:$(window).height()+"px"},"slow",complete))},routing:null,routingEnabled:!0,mobileRun:!1,showLog:!0,showObj:!0,showDebug:!0,showWarn:!0,showOk:!0,mainController:"Home",initialView:null,rootPath:"app",lang:"en",replaceLangKeys:!1,dbMode:"none",dbTestMode:!0,dbTestScript:"sql/test.sql",dbProductionScript:"sql/production.sql",dbName:"local_db",componentDirectory:"component",controllerDirectory:"controller",modalDirectory:"modal",partialDirectory:"partial",extend:function(configObj){for(var prop in configObj)app.config[prop]=configObj[prop]}},app.events={onRender:function(){},domEvents:function(){},onOnline:function(){},onOffline:function(){},onBack:function(){},onDeviceReady:function(){},onReady:function(){},extend:function(eventsMap){$.each(eventsMap,function(eventName,eventCallback){app.events.__extend(eventName,eventCallback)})},__functionName:function(eventName){switch(eventName){case"render":return"onRender";case"offline":return"onOffline";case"online":return"onOnline";case"dom":return"domEvents";case"back":return"onBack";case"ready":return"onReady";default:return eventName}},__extend:function(eventName,eventCallback){app.events[app.events.__functionName(eventName)]=eventCallback}},app.__cordova={__deviceReadyCallBack:null,__initializeCordova:function(callBack){app.debug("Invoke cordova.__initializeCordova with params: {0}",[callBack]),app.__cordova.__bindDOMEvents(),callBack()},__bindDOMEvents:function(){app.debug("Invoke cordova.__bindDOMEvents"),document.addEventListener("deviceready",app.__cordova.__onDeviceReady,!1),document.addEventListener("backbutton",app.__cordova.__onBack,!1),void 0!==app.events.domEvents&&app.events.domEvents()},__checkNetwork:function(){app.debug("Invoke cordova.__checkNetwork"),app.plugins.wrapper.network.connection(function(){app.__cordova.__onOnline()},function(){app.__cordova.__onOffline()})},__onBack:function(e){app.debug("Invoke cordova.__onBack"),e&&e.preventDefault(),null!==app.mCtx&&void 0!==app.mCtx.onBack?app.mCtx.onBack():null!==app.mCtx&&void 0==app.mCtx.onBack?app.modal.invalidateAll():null!==app.ctx&&void 0!==app.ctx.onBack?(app.modal.invalidateAll(),app.ctx.onBack()):app.events.onBack&&app.events.onBack()},__onDeviceReady:function(){app.debug("Invoke cordova.__onDeviceReady"),app.__cordova.__deviceReadyCallBack&&app.__cordova.__deviceReadyCallBack()},__onOnline:function(){app.debug("Invoke cordova.__onOnline"),app.online=!0,app.events.onOnline&&app.events.onOnline()},__onOffline:function(){app.debug("Invoke cordova.__onOffline"),app.online=!1,app.events.onOffline&&app.events.onOffline()}},app.message={__waitingForTranslations:{},__messages:{},add:function(languageName,languageFilePath){this.register(languageName,languageFilePath)},register:function(languageName,languageFilePath){app.log("register translation {0}",[languageName]),app.message.__waitingForTranslations[languageName]=!1,$.ajax({url:languageFilePath,type:"GET",success:function(data){app.log("AJAX loaded"),app.message.__setTranslation(languageName,data)},error:function(error){app.log("AJAX error {0} ",[error]),200==error.status?app.message.__setTranslation(languageName,error.responseText):(app.message.__messages[languageName]={},app.system.__throwWarn(app.system.__messages.TRANSLATION_LOAD_WARN,[languageName,error.status]))}})},__setTranslation:function(languageName,translationData){if("string"==typeof translationData)try{translationData=JSON.parse(translationData)}catch(err){app.system.__throwError(app.system.__messages.TRANSLATION_PARSING,[languageName])}app.message.__messages[languageName]=translationData,app.message.__waitingForTranslations[languageName]=!0},get:function(messageName){return app.message.__messages[app.config.lang][messageName]||messageName},__translate:function(){void 0==app.message.__waitingForTranslations[app.config.lang]&&app.system.__throwError(app.system.__messages.TRANSLATION_NOT_EXIST,[app.config.lang]),setTimeout(function(){1==app.message.__waitingForTranslations[app.config.lang]?app.message.__translateDOM():0==app.message.__waitingForTranslations[app.config.lang]&&app.message.__translate()},100)},__translateDOM:function(){app.log("__translateDOM"),$(document).ready(function(){$("["+app.__attributes.TRANSLATION+"]").each(function(){var messageName=$(this).attr(app.__attributes.TRANSLATION);$(this).html(app.message.__messages[app.config.lang][messageName]||messageName)})})},__replaceTemplateKeys:function(templateHtml){for(var messageName in app.message.__messages[app.config.lang])templateHtml=templateHtml.split(">"+messageName+"<").join(">"+app.message.__messages[app.config.lang][messageName]+"<");return templateHtml}},app.component={__dataArchive:{},add:function(componentName,componentObject){this.register(componentName,componentObject)},register:function(componentName,componentObject){app.system.__filterRestrictedNames(componentName),componentObject.inherits&&(componentObject=app.abstract.__tryExtend(componentName,componentObject.inherits,componentObject)),app.log("Registering component {0}",[componentName]),app.debug("Invoke component.register with params: {0} {1}",[componentName,componentObject]),componentObject.__type="COMPONENT",componentObject.self=function(){return app.component[componentName]},componentObject.__name=componentName,componentObject.__lowerCaseName=componentName.substring(0,1).toLowerCase()+componentName.substring(1,componentName.length),componentObject.__globalRendered=!1,componentObject.global?componentObject.__global=!0:componentObject.__global=!1,componentObject.__render=function(componentDataPassed){if(app.debug("Invoke componentObject.__render on {0} component with params: {1}",[componentObject.__name,componentDataPassed]),app.component[componentObject.__name]&&1==app.component[componentObject.__name].__global&&1==app.component[componentObject.__name].__globalRendered)return void app.debug("Component {0} is already globally rendered. Returning from _render...",[componentObject.__name]);app.component[componentObject.__name]&&1==app.component[componentObject.__name].__global&&0==app.component[componentObject.__name].__globalRendered&&(app.debug("Component {0} will be rendered globally",[componentObject.__name]),app.component[componentObject.__name].__globalRendered=!0),app.component[componentObject.__name]=$.extend(!0,{},app.component.__dataArchive[componentObject.__name]),app.com[componentObject.__name]=app.component[componentObject.__name],app.com[componentObject.__name].__loadTemplate(),componentDataPassed||(componentDataPassed={}),app.debug("Binding component {0} template to DOM",[app.com[componentObject.__name].__name]);var componentSelector=$('component[name="'+app.com[componentObject.__name].__lowerCaseName+'"]');componentSelector||app.system.__throwError(app.system.__messages.COMPONENT_NOT_DECLARED_IN_VIEW,[componentObject.__name]),app.debug("Reading component {0} inline params",[app.com[componentObject.__name].__name]);var inlineAttributes=componentSelector.attrs();componentDataPassed=$.extend(!0,componentDataPassed,inlineAttributes),componentSelector.replaceWith(app.com[componentObject.__name].__template),app.system.__bindEvents(componentSelector),app.message.__translate(),componentDataPassed=$.extend(!0,componentDataPassed,app.router.__getCurrentViewData().data),app.component.__initComponents(app.com[componentObject.__name].components),app.debug("Invoke component {0} init() function",[componentObject.__name]),app.com[componentObject.__name].init(componentDataPassed)},componentObject.__createComponentViewPath=function(componentObject){app.debug("Invoke componentObject.__createComponentViewPath with params: {0}",[componentObject]),componentObject.__view=app.config.rootPath+"/"+app.config.componentDirectory+"/"+componentObject.__lowerCaseName+"/"+componentObject.__lowerCaseName+".view.html"},componentObject.__loadTemplate=function(){app.debug("Invoke componentObject.__loadTemplate");var templateHtml=window[app.__globalTemplates][app.component[componentObject.__name].__view];templateHtml||app.system.__throwError("No view found for component: {0}, view path: {1}",[componentObject.__name,componentObject.__view]);try{templateHtml=templateHtml()}catch(err){app.system.__throwError("Error occured when executing component {0} template {1}",[componentObject.__name,componentObject.__view])}templateHtml=app.system.__replacePlainTemplates(templateHtml);var selectorsObj=app.system.__createSelectors(templateHtml);app.component[componentObject.__name].selector=selectorsObj.selectors,templateHtml=selectorsObj.html,app.config.replaceLangKeys&&(templateHtml=app.message.__replaceTemplateKeys(templateHtml)),app.component[componentObject.__name].__plainTemplate=templateHtml,app.component[componentObject.__name].__template=templateHtml},componentObject.__createComponentViewPath(componentObject),app.component.__dataArchive[componentObject.__name]=$.extend(!0,{},componentObject),app.component[componentObject.__name]=$.extend(!0,{},componentObject)},__initComponents:function(componentsArrayOrMap){app.debug("Invoke component.__initComponents with params: {0}",[componentsArrayOrMap]),componentsArrayOrMap&&(componentsArrayOrMap instanceof Array?$.each(componentsArrayOrMap,function(i,componentName){app.component[componentName]||app.system.__throwError(app.system.__messages.COMPONENT_NOT_DECLARED_IN_COMPONENTS,[componentName]),app.component[componentName].__render(null)}):$.each(componentsArrayOrMap,function(componentName,componentParams){app.component[componentName]||app.system.__throwError(app.system.__messages.COMPONENT_NOT_DECLARED_IN_COMPONENTS,[componentName]),app.component[componentName].__render(componentParams)}))},__initGlobalComponents:function(){$("body").find("component").each(function(i,element){element=$(this);var componentName=element.attr("name");0==componentName.length&&app.system.__throwError(app.system.__messages.OUTSIDE_CONTEXT_COMPONENT_NO_NAME),componentName=componentName.substring(0,1).toUpperCase()+componentName.substring(1,componentName.length);var component=app.component[componentName];component?1==component.__global?component.__render(null):app.system.__throwError(app.system.__messages.OUTSIDE_CONTEXT_COMPONENT_NOT_GLOBAL,[componentName]):app.system.__throwError(app.system.__messages.OUTSIDE_CONTEXT_COMPONENT_NOT_FOUND,[componentName])})}},app.controller={__dataArchive:{},add:function(controllerName,controllerObject){this.register(controllerName,controllerObject)},register:function(controllerName,controllerObject){app.system.__filterRestrictedNames(controllerName),controllerObject.inherits&&(controllerObject=app.abstract.__tryExtend(controllerName,controllerObject.inherits,controllerObject)),app.log("Registering controller {0}",[controllerName]),app.debug("Invoke controller.register with params: {0} {1}",[controllerName,controllerObject]),controllerObject.__type="CONTROLLER",controllerObject.self=function(){return app.controller[controllerName]},controllerObject.checkNetwork||(controllerObject.checkNetwork=!1),controllerObject.components||(controllerObject.components=[]),controllerObject.__name=controllerName,controllerObject.__lowerCaseName=controllerName.substring(0,1).toLowerCase()+controllerName.substring(1,controllerName.length),controllerObject.__render=function(controllerPassedData){app.debug("Invoke controllerObject.__render with params: {0}",[controllerPassedData]),app.controller[controllerObject.__name]=$.extend(!0,{},app.controller.__dataArchive[controllerObject.__name]);var __oldControllerName=app.ctx?app.ctx.__name:null;if(app.ctx=app.controller[controllerObject.__name],app.ctx.__loadTemplate(),app.currentController=controllerObject.__name.toLowerCase(),app.debug('Binding controller {0} template to DOM element with "view" attribute ',[app.ctx.__name]),app.config.transitions&&app.config.transitionAnimation){var transitionViewId="transition-view"+app.util.System.hash();app.controller.__getView().before('<div style="display: none;" id="'+transitionViewId+'">'+app.controller.__getView().html()+"</div>"),app.controller.__getView().html(app.ctx.__template),app.config.transitionAnimation($("#"+transitionViewId),app.controller.__getView(),app.__starting,__oldControllerName,app.ctx.__name,function(){$("#"+transitionViewId).remove()})}else app.controller.__getView().html(app.ctx.__template);
app.message.__translate(),app.system.__bindEvents(app.controller.__getView()),app.component.__initComponents(app.ctx.components),app.modal.invalidateAll(),app.debug("Invoke controller {0} init() function",[app.ctx.__name]),app.ctx.init(controllerPassedData)},controllerObject.__createControllerViewPath=function(controllerObject){app.debug("Invoke controllerObject.__createControllerViewPath with params: {0}",[controllerObject]),controllerObject.__view=app.config.rootPath+"/"+app.config.controllerDirectory+"/"+controllerObject.__lowerCaseName+"/"+controllerObject.__lowerCaseName+".view.html"},controllerObject.__loadTemplate=function(){app.debug("Invoke controllerObject.__loadTemplate");var templateHtml=window[app.__globalTemplates][app.ctx.__view];templateHtml||app.system.__throwError("No view found for controller: {0}, view path: {1}",[controllerObject.__name,controllerObject.__view]);try{templateHtml=templateHtml()}catch(err){app.system.__throwError("Error occured when executing controller {0} template {1}",[controllerObject.__name,controllerObject.__view])}templateHtml=app.system.__replacePlainTemplates(templateHtml);var selectorsObj=app.system.__createSelectors(templateHtml);app.ctx.selector=selectorsObj.selectors,templateHtml=selectorsObj.html,app.config.replaceLangKeys&&(templateHtml=app.message.__replaceTemplateKeys(templateHtml)),app.ctx.__plainTemplate=templateHtml,app.ctx.__template=templateHtml},controllerObject.__createControllerViewPath(controllerObject),app.controller.__dataArchive[controllerName]=$.extend(!0,{},controllerObject),app.controller[controllerName]=$.extend(!0,{},controllerObject)},__getView:function(){return app.system.getView()},__verifyView:function(){0==this.__getView().length&&app.system.__throwError("No DOM element with {0} attribute specified",[app.__attributes.VIEW])}},app.modal={__modalWrappers:{},__dataArchive:{},implement:function(eventName,eventFunction){app.debug("Invoke modal.implement with params: {0} {1}",[eventName,eventFunction]),eventName&&eventFunction||app.system.__throwError("modal.implement(eventName, eventFunction) passed arguments not match required arguments"),"hide"==eventName?app.modal.__onModalHideEvent=eventFunction:"show"==eventName?app.modal.__onModalShowEvent=eventFunction:"render"==eventName?app.modal.__onModalRenderEvent=eventFunction:"register"==eventName?app.modal.__onModalRegisterEvent=eventFunction:app.warn("Ignoring event: {0} implementation for modal, no event available",[eventName])},__onModalShowEventDefault:function(modalSelector){app.debug("Invoke modal.__onModalShowEventDefault"),modalSelector.show(200)},__onModalHideEventDefault:function(modalSelector){app.debug("Invoke modal.__onModalHideEventDefault"),modalSelector.hide(200)},__onModalRegisterEvent:function(modalObject){},__onModalRenderEvent:function(modalSelector,modalObject){},__onModalShowEvent:function(modalSelector,modalObject,defaultImpl){defaultImpl(modalSelector)},__onModalHideEvent:function(modalSelector,modalObject,defaultImpl){defaultImpl(modalSelector)},add:function(modalName,modalObject){this.register(modalName,modalObject)},register:function(modalName,modalObject){app.system.__filterRestrictedNames(modalName),modalObject.inherits&&(modalObject=app.abstract.__tryExtend(modalName,modalObject.inherits,modalObject)),app.debug("Invoke modal.register with params: {0} {1}",[modalName,modalObject]),modalObject.__type="MODAL",modalObject.self=function(){return app.modal[modalName]},modalObject.__hidden=!1,modalObject.__name=modalName,modalObject.__lowerCaseName=modalName.substring(0,1).toLowerCase()+modalName.substring(1,modalName.length),app.modal.__onModalRegisterEvent(modalObject),modalObject.__createModalViewPath=function(modalObject){app.debug("Invoke modalObject.__createModalViewPath with params: {0}",[modalObject]),modalObject.__view=app.config.rootPath+"/"+app.config.modalDirectory+"/"+modalObject.__lowerCaseName+"/"+modalObject.__lowerCaseName+".view.html"},modalObject.__loadTemplate=function(){app.debug("Invoke modalObject.__loadTemplate");var templateHtml=window[app.__globalTemplates][app.mCtx[modalObject.__name].__view];templateHtml||app.system.__throwError("No view found for modal: {0}, view path: {1}",[modalObject.__name,modalObject.__view]);try{templateHtml=templateHtml()}catch(err){app.system.__throwError("Error occured when executing modal {0} template {1}",[modalObject.__name,modalObject.__view])}templateHtml=app.system.__replacePlainTemplates(templateHtml);var selectorsObj=app.system.__createSelectors(templateHtml);app.mCtx[modalObject.__name].selector=selectorsObj.selectors,templateHtml=selectorsObj.html,app.config.replaceLangKeys&&(templateHtml=app.message.__replaceTemplateKeys(templateHtml)),app.mCtx[modalObject.__name].__plainTemplate=templateHtml,app.mCtx[modalObject.__name].__template=templateHtml},modalObject.__render=function(modalPassedData){app.debug("Invoke modalObject.__render with params: {0}",[modalPassedData]),app.modal[modalObject.__name]=$.extend(!0,{},app.modal.__dataArchive[modalObject.__name]),app.mCtx[modalObject.__name]=app.modal[modalObject.__name],app.mCtx[modalObject.__name].__loadTemplate(),app.debug('Binding modal {0} template to DOM element with "modals" attribute ',[app.mCtx[modalObject.__name].__name]),app.mCtx[modalObject.__name].__wrapModal(),app.component.__initComponents(app.mCtx[modalObject.__name].components),app.modal.__modalWrappers[modalObject.__name]=app.modal[modalObject.__name].__modalWrapperId,app.debug("Invoke modal {0} init() function",[app.mCtx[modalObject.__name].__name]),app.mCtx[modalObject.__name].init(modalPassedData)},modalObject.__wrapModal=function(){app.mCtx[modalObject.__name].__modalWrapperId="modal-wrapper-"+app.util.System.hash(),app.modal.__getView().append('<div id="'+app.mCtx[modalObject.__name].__modalWrapperId.replace("#","")+'">'+app.mCtx[modalObject.__name].__template+"</div>"),app.message.__translate(),app.mCtx[modalObject.__name].__modalId="modal-"+app.util.System.hash();var modalSelector=app.mCtx[modalObject.__name].__getWrapperModalSelector();modalSelector.attr("id",app.mCtx[modalObject.__name].__modalId),app.system.__bindEvents(modalSelector),app.modal.__onModalRenderEvent(modalSelector,app.mCtx[modalObject.__name])},modalObject.__wrapperSelector=function(){return $("#"+app.modal[modalObject.__name].__modalWrapperId)},modalObject.__selfSelector=function(){return $("#"+app.modal[modalObject.__name].__modalId)},modalObject.__getWrapperModalSelector=function(){var wrapperSelectorChildrens=app.modal[modalObject.__name].__wrapperSelector().children();return 1==wrapperSelectorChildrens.length?wrapperSelectorChildrens:void(wrapperSelectorChildrens.length>1?app.system.__throwError("Modal {0} view can only have one parent DOM element, found {1}",[modalObject.__name,wrapperSelectorChildrens.length]):0==wrapperSelectorChildrens.length&&app.system.__throwError("Modal {0} view must have one parent DOM element",[modalObject.__name]))},modalObject.show=function(){app.modal[modalObject.__name].__hidden=!1,app.modal.__onModalShowEvent(app.mCtx[modalObject.__name].__selfSelector(),app.mCtx[modalObject.__name],app.modal.__onModalShowEventDefault)},modalObject.hide=function(){app.modal[modalObject.__name].__hidden=!0,app.modal.__onModalHideEvent(app.mCtx[modalObject.__name].__selfSelector(),app.mCtx[modalObject.__name],app.modal.__onModalHideEventDefault)},modalObject.__createModalViewPath(modalObject),app.modal.__dataArchive[modalObject.__name]=$.extend(!0,{},modalObject),app.modal[modalObject.__name]=$.extend(!0,{},modalObject)},__getView:function(){return $("["+app.__attributes.MODALS+"]")},__verifyView:function(){0==this.__getView().length&&app.system.__throwError("No DOM element with {0} attribute specified",[app.__attributes.MODALS])},__invalidate:function(modalObject){delete app.modal.__modalWrappers[modalObject.__name],modalObject.__wrapperSelector().remove()},invalidateAll:function(){$.each(app.modal,function(modalName,modalObject){modalObject instanceof Object&&modalObject.__type&&app.modal.__invalidate(modalObject)})},hideAll:function(){$.each(app.mCtx,function(modalName,modalObject){modalObject.hide()})}},app.partial={__dataArchive:{},include:function(partial,model){return partial||app.system.__throwError(app.system.__messages.PARITAL_INCLUDE_NOT_DEFINED,[partial.__name]),app.debug("Invoke app.partial.include with params: {0} ",[partial.__name]),model||(model={}),app.partial[partial.__name]=$.extend(!0,{},app.partial.__dataArchive[partial.__name]),app.debug("Returning partial {0} template ",[partial.__name]),partial.__template($.extend(!0,partial,model))},add:function(partialName){this.register(partialName)},register:function(partialName,partialObject){app.system.__filterRestrictedNames(partialName),partialObject.inherits&&(partialObject=app.abstract.__tryExtend(partialName,partialObject.inherits,partialObject)),app.log("Registering partial {0}",[partialName]),app.debug("Invoke partial.register with params: {0} {1}",[partialName,partialObject]),app.util.System.isNull(partialObject.replace)&&(partialObject.replace=!1),partialObject.__replace=partialObject.replace,partialObject.__type="PARTIAL",partialObject.__name=partialName,partialObject.__lowerCaseName=partialName.substring(0,1).toLowerCase()+partialName.substring(1,partialName.length),partialObject.render=function(selector,model){app.debug("Invoke partialObject.__render");var __partialObject=$.extend(!0,{},app.partial.__dataArchive[partialObject.__name]);selector||app.system.__throwError(app.system.__messages.PARITAL_SELECTOR_NOT_DEFINED,[__partialObject.__name]),__partialObject.before&&app.util.System.isFunction(__partialObject.before)&&(app.debug("Invokes partial  {0} before() function",[__partialObject.__name]),__partialObject.before()),app.debug("Binding partial {0} template to passed selector {1} ",[__partialObject.__name,selector]);var renderedTemplate=__partialObject.__template($.extend(!0,__partialObject,model));templateHtml=app.system.__replacePlainTemplates(templateHtml),app.config.replaceLangKeys&&(renderedTemplate=app.message.__replaceTemplateKeys(renderedTemplate)),__partialObject.__replace?selector=app.partial.__replacePartial(selector,renderedTemplate):selector.html(renderedTemplate),app.system.__bindEvents(selector),app.message.__translate()},partialObject.__createPartialViewPath=function(partialObject){app.debug("Invoke partialObject.__createPartialViewPath with params: {0}",[partialObject]),partialObject.__view=app.config.rootPath+"/"+app.config.partialDirectory+"/"+partialObject.__lowerCaseName+"/"+partialObject.__lowerCaseName+".partial.html"},partialObject.__loadTemplate=function(){app.debug("Invoke partialObject.__loadTemplate");var templateFunction=window[app.__globalTemplates][partialObject.__view];templateFunction||app.system.__throwError("No view found for partial: {0}, view path: {1}",[partialObject.__name,partialObject.__view]),partialObject.__template=templateFunction},partialObject.__createPartialViewPath(partialObject),partialObject.__loadTemplate(),app.partial.__dataArchive[partialName]=$.extend(!0,{},partialObject),app.partial[partialName]=$.extend(!0,{},partialObject)},__replacePartial:function(selector,templateHtml){var selectorId=selector.attr("id"),rootElementPart=templateHtml.substring(0,templateHtml.indexOf(">"));return rootElementPart+=' id="'+selectorId+'" ',templateHtml=rootElementPart+templateHtml.substring(templateHtml.indexOf(">"),templateHtml.length),selector.replaceWith(templateHtml),app.system.__clearSelectorInCache(selectorId),$("#"+selectorId)}},app.abstract={add:function(abstractName,abstractObject){this.register(abstractName,abstractObject)},register:function(abstractName,abstractObject){app.system.__filterRestrictedNames(abstractName),app.abstract[abstractName]&&app.system.__throwError(app.system.__messages.ABSTRACT_ALREADY_REGISTRED,[abstractName]),abstractObject.__name=abstractName,app.abstract[abstractName]=abstractObject},__tryExtend:function(extendObjectName,abstractObjectsList,extendedObject){if(app.debug("Invoking app.abstract.__tryExtend with params {0}",[extendObjectName]),$.isArray(abstractObjectsList)){app.log("Extending {0} named {1} ",[extendedObject.__type,extendObjectName,app.abstract.__getNames(abstractObjectsList)]);for(var i=0;i<abstractObjectsList.length;i++)abstractObjectsList[i]?extendedObject=app.abstract.__extend(abstractObjectsList[i].__name,extendedObject):app.system.__throwWarn(app.system.__messages.INHERIT_ABSTRACT_NOT_EXIST,[extendObjectName])}return extendedObject},__getNames:function(abstractObjectsList){var names=[];return $.each(abstractObjectsList,function(i,abstractObject){abstractObject&&names.push(abstractObject.__name)}),names},__extend:function(extendObjectName,extendedObject){return $.extend(!0,extendedObject,app.abstract[extendObjectName])}},app.enumerator={add:function(enumeratorName,enumeratorObject){this.register(enumeratorName,enumeratorObject)},register:function(enumeratorName,enumeratorObject){app.enumerator[enumeratorName]&&app.system.__throwError(app.system.__messages.ENUMERATOR_ALREADY_REGISTRED,[enumeratorName]),app.enumerator[enumeratorName]=enumeratorObject}},app.global={add:function(globalName,globalInitialValue){this.register(globalName,globalInitialValue)},register:function(globalName,globalInitialValue){app.system.__filterRestrictedNames(globalName),app.global[globalName]={__value:null,get:function(index){return index?this.__value[index]:this.__value},set:function(newGlobalValue,index){this.__value&&index?this.__value[index]=newGlobalValue:this.__value=newGlobalValue},push:function(newGlobalValueArrayItem){this.__value&&this.__value instanceof Array&&this.__value.push(newGlobalValueArrayItem)}},this.__value=value},list:function(globalObjectsList){$.each(globalObjectsList,function(i,__global){app.global.add(__global.name,__global.initial)})}},app.service={add:function(serviceName,serviceObject){this.register(serviceName,serviceObject)},register:function(serviceName,serviceObject){app.system.__filterRestrictedNames(serviceName),serviceObject.inherits&&(serviceObject=app.abstract.__tryExtend(serviceName,serviceObject.inherits,serviceObject)),app.service[serviceName]&&app.system.__throwError(app.system.__messages.SERVICE_ALREADY_REGISTRED,[serviceName]),app.service[serviceName]=serviceObject}},app.plugins={add:function(pluginName,pluginWrapperFunction){this.register(pluginName,pluginWrapperFunction)},register:function(pluginName,pluginWrapperFunction){app.plugins[pluginName]=pluginWrapperFunction},list:function(pluginsWrapperFunctionsMap){$.each(pluginsWrapperFunctionsMap,function(pluginName,pluginWrapperFunction){app.global.add(pluginName,pluginWrapperFunction)})}},app.util={add:function(utilName,utilFunctions){this.register(utilName,utilFunctions)},register:function(utilName,utilFunctions){app.util[utilName]&&app.system.__throwError(app.system.__messages.UTIL_ALREADY_REGISTRED,[utilName]),app.util[utilName]=utilFunctions},System:{toCamelCase:function(str){return app.util.System.isEmpty(str)?str:(str=str.split("-").join(" "),str.replace(/(?:^\w|[A-Z]|\b\w|\s+)/g,function(match,index){return 0===+match?"":0==index?match.toLowerCase():match.toUpperCase()}))},copyArray:function(oldArray){return JSON.parse(JSON.stringify(oldArray))},currentDateLog:function(){return(new Date).toLocaleTimeString()},bindStringParams:function(string,objectOrArrayParams){if(!objectOrArrayParams)return string;if(objectOrArrayParams instanceof Array)for(var i=0;i<objectOrArrayParams.length;i++)string=string.replace("{"+i+"}",JSON.stringify(objectOrArrayParams[i]));else for(var paramName in objectOrArrayParams)string=string.replace("{"+paramName+"}",JSON.stringify(objectOrArrayParams[paramName]));return string},isFunction:function(functionToCheck){var getType={};return functionToCheck&&"[object Function]"===getType.toString.call(functionToCheck)},isObject:function(object){return!app.util.System.isNull(object)&&"[object Object]"==object.toString()},parseJSON:function(s){s=s.replace(/\\n/g,"\\n").replace(/\\'/g,"\\'").replace(/\\"/g,'\\"').replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f"),s=s.replace(/[\u0000-\u0019]+/g,"");var o=JSON.parse(s);return o},isEmpty:function(obj){return void 0==obj||null==obj||"string"==typeof obj&&0==obj.trim().length},tryParseNumber:function(obj){return!app.util.System.isEmpty(obj)&&$.isNumeric(obj)?app.util.System.isInt(parseFloat(obj))?parseInt(obj,10):parseFloat(obj):obj},isInt:function(n){return Number(n)===n&&n%1===0},isFloat:function(n){return Number(n)===n&&n%1!==0},isNull:function(obj){return void 0==obj||null==obj},preparePathDottedParams:function(url,params){for(var prop in params)url=url.replace(":"+prop,params[prop]);return url},prepareUrlParams:function(url,params){var i=0;for(var prop in params)url=0==i?url+"?"+prop+"="+params[prop]:url+"&"+prop+"="+params[prop],i++;return url},findStringBetween:function(str,first,last){var r=new RegExp(first+"(.*?)"+last,"gm"),arr=str.match(r);if(null==arr||0==arr.length)return[];for(var arr2=[],i=0;i<arr.length;i++)arr2.push(arr[i].replace(first,"").replace(last,""));return arr2},hash:function(){for(var text="",possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<10;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text}}},app.crud={__replaceBooleanToString:function(sql){return sql=sql.split("'true'").join("'bool_true'"),sql=sql.split("'false'").join("'bool_false'"),sql=sql.split(" true").join("'bool_true'"),sql=sql.split(" false").join("'bool_false'")},execute:function(sql,successCallback,errorCallback){app.util.System.isFunction(sql)&&(sql=sql()),sql=this.__replaceBooleanToString(sql);var array=[],lastId=null;app.__database.__dbInstance.transaction(function(tx){tx.executeSql(sql,[],function(tx,results){if(sql.toLowerCase().indexOf("insert")>-1)lastId=results.insertId;else{var i,len=results.rows.length;for(i=0;i<len;i++){var item=results.rows.item(i);array.push(item)}}},null)},function(err){void 0!==errorCallback&&errorCallback(),app.error("Error executing query {0}",[sql])},function(){void 0!==successCallback&&successCallback(sql.toLowerCase().indexOf("insert")!=-1?lastId:array)})},builder:{findById:function(tableName,id){return"select * from "+tableName+" where id = "+id},deleteById:function(tableName,id){return"delete from "+tableName+" where id = "+id},drop:function(tableName){return"DROP TABLE IF EXISTS "+tableName},count:function(tableName){return"select count(*) as count from "+tableName},create:function(tableName,columns){for(var sql="CREATE TABLE IF NOT EXISTS "+tableName+" (id INTEGER PRIMARY KEY",i=0;i<columns.length;i++)sql+=", "+columns[i];return sql+=")"},findAll:function(tableName){return"SELECT * FROM "+tableName},select:function(tableName,values,columns){var sql="";sql="select * from "+tableName+" where ";for(var i=0;i<values.length;i++)sql+="string"==typeof values[i]||"boolean"==typeof values[i]?" "+columns[i]+"='"+values[i]+"' and ":" "+columns[i]+"="+values[i]+" and ";return sql=sql.substr(0,sql.length-4)},insert:function(tableName,values,columns){var sql="";if(void 0!==columns){sql="INSERT INTO "+tableName+" (";for(var i=0;i<columns.length;i++)sql+=columns[i]+",";sql=sql.substr(0,sql.length-1),sql+=") VALUES ("}else sql="INSERT INTO "+tableName+" VALUES (";for(var i=0;i<values.length;i++)sql+="string"==typeof values[i]||"boolean"==typeof values[i]?" '"+values[i]+"',":" "+values[i]+",";return sql=sql.substr(0,sql.length-1),sql+=")"},update:function(tableName,id,values,columns){var sql="";sql="UPDATE "+tableName+" SET ";for(var i=0;i<values.length;i++)sql+="string"==typeof values[i]||"boolean"==typeof values[i]?" "+columns[i]+"= '"+values[i]+"',":" "+columns[i]+"= "+values[i]+",";return sql=sql.substr(0,sql.length-1),sql+=" where id = "+id}}},app.__database={__dbInstance:null,__tablesCount:0,__dbName:"",__dbVersion:"1.0",__dbSize:2097152,__createDB:function(callBack){if(app.__database.__dbName=app.config.dbName,"none"==app.config.dbMode)app.__database.__dbInstance=null,app.system.__mainRender(callBack);else{if(app.config.mobileRun)app.__database.__dbInstance=window.sqlitePlugin.openDatabase({name:app.__database.__dbName,location:"default"});else try{app.__database.__dbInstance=openDatabase(app.__database.__dbName,app.__database.__dbVersion,app.__database.__dbName+"_manager",app.__database.__dbSize)}catch(error){app.system.__noSupport()}"create-drop"==app.config.dbMode?app.__database.__dbDrop(function(){app.__database.__dbCreate(function(){app.__database.__dbLoadData(function(){app.system.__mainRender(callBack)})})}):"create"==app.config.dbMode&&app.__database.__dbCreate(function(){app.__database.__dbLoadData(function(){app.system.__mainRender(callBack)})})}},__dbLoadData:function(callBack){app.debug("Invoke database.__dbLoadData");var finished=!1;app.config.dbTestMode?$.get(app.config.dbTestScript,function(data){if(0==data.trim().length)finished=!0,callBack();else{for(var queries=[],splitted=data.split(";"),i=0;i<splitted.length;i++)splitted[i].trim().length>0&&queries.push(splitted[i].trim());for(var i=0;i<queries.length;i++)app.crud.execute(queries[i],function(data){app.__database.__tablesCount++,app.__database.__tablesCount>=queries.length&&(app.__database.__tablesCount=0,finished||(finished=!0,callBack()))})}}):$.get(app.config.dbProductionScript,function(data){if(0==data.trim().length)finished=!0,callBack();else{for(var queries=[],splitted=data.split(";"),i=0;i<splitted.length;i++)splitted[i].trim().length>0&&queries.push(splitted[i].trim());for(var i=0;i<queries.length;i++)app.crud.execute(queries[i],function(data){app.__database.__tablesCount++,app.__database.__tablesCount>=queries.length&&(app.__database.__tablesCount=0,finished||(finished=!0,callBack()))})}})},__dbCreate:function(callBack){if(app.debug("Invoke database.__dbCreate"),app.model.__createScripts.length>0)for(var i=0;i<app.model.__createScripts.length;i++)app.crud.execute(app.model.__createScripts[i],function(data){app.__database.__tablesCount++,app.__database.__tablesCount==app.model.__createScripts.length&&(app.__database.__tablesCount=0,callBack())});else callBack()},__dbDrop:function(callBack){if(app.debug("Invoke database.__dbDrop"),app.model.__dropScripts.length>0)for(var i=0;i<app.model.__dropScripts.length;i++)app.crud.execute(app.model.__dropScripts[i],function(data){app.__database.__tablesCount++,app.__database.__tablesCount==app.model.__dropScripts.length&&(app.__database.__tablesCount=0,callBack())});else callBack()}},app.model={__createScripts:[],__dropScripts:[],add:function(modelName,modelColumns){this.register(modelName,modelColumns)},register:function(modelName,modelColumns){for(var _columns=app.util.System.copyArray(modelColumns),columns=[],i=0;i<_columns.length;i++)"id"!==_columns[i].toLowerCase()&&columns.push(_columns[i]);var nameUpperCase=modelName.toUpperCase(),dropTableSql=app.crud.builder.drop(nameUpperCase),createTableSql=app.crud.builder.create(nameUpperCase,columns);app.crud.builder.findAll(nameUpperCase);app.model.__createScripts.push(createTableSql),app.model.__dropScripts.push(dropTableSql);var columnsAll=app.util.System.copyArray(columns).push("id"),modelObject={table:nameUpperCase,columns:columns,__columnsAll:columnsAll,__dropSQL:dropTableSql,__createSQL:createTableSql,new:function(valueList){for(var modelObj={},i=0;i<this.columns;i++)void 0!==valueList[this.columns[i]]?modelObj[this.columns[i]]=valueList[this.columns[i]]:modelObj[this.columns[i]]=null;return modelObj}};app.model[modelName]=modelObject}},app.query={list:function(queryObjectsList){$.each(queryObjectsList,function(i,queryObj){app.query.register(queryObj.name,queryObj.sql,queryObj.group)})},add:function(queryName,querySQL,queryGroup){this.register(queryName,querySQL,queryGroup)},register:function(queryName,querySQL,queryGroup){app.util.System.isFunction(querySQL)&&(querySQL=querySQL());var queryObj={__sql:querySQL,bind:function(queryParamsListOrMap){var sql=this.__sql;return sql=queryParamsListOrMap instanceof Array?this.__bindArrayParams(queryParamsListOrMap,sql):this.__bindMapParams(queryParamsListOrMap,sql)},__bindArrayParams:function(paramsList,sql){for(var i=0;i<paramsList.length;i++)sql="string"==typeof paramsList[i]?sql.replace("?","'"+paramsList[i]+"'"):sql.replace("?",paramsList[i]);return sql},__bindMapParams:function(paramsObject,sql){for(var fieldName in paramsObject){var fieldValue=paramsObject[fieldName];sql="string"==typeof fieldValue?sql.replace(":"+fieldName,"'"+fieldValue+"'"):sql.replace(":"+fieldName,fieldValue)}return sql},execute:function(successCallback,errorCallback,queryParamsListOrMap){var sqlToExecute=this.__sql;app.util.System.isNull(queryParamsListOrMap)||(sqlToExecute=this.bind(queryParamsListOrMap)),app.crud.execute(sqlToExecute,successCallback,errorCallback)}};app.util.System.isNull(queryGroup)?app.query[queryName]=queryObj:(app.util.System.isNull(app.query[queryGroup])&&(app.query[queryGroup]={}),app.query[queryGroup][queryName]=queryObj)}},app.rest={api:{},spinnerExclude:[],__interceptors:{},interceptor:function(interceptorName,interceptorFunction){app.rest.__interceptors[interceptorName]&&app.system.__throwError(app.system.__messages.INTERCEPTOR_ALREADY_REGISTRED,[interceptorName]),app.rest.__interceptors[interceptorName]=interceptorFunction},__invokeInterceptors:function(response,promise,interceptors){for(var i=0;i<interceptors.length;i++)app.rest.__interceptors[interceptors[i]]?app.rest.__interceptors[interceptors[i]](response,promise):app.system.__throwWarn(app.system.__messages.INTERCEPTOR_NOT_EXISTS,[interceptors[i]])},spinnerShow:function(requestUrl){},spinnerHide:function(requestUrl){},isSpinnerExcluded:function(requestUrl){for(var i=0;i<app.rest.spinnerExclude.length;i++)if(requestUrl==app.rest.spinnerExclude[i])return!0;return!1},__isEnabledMockByUrlAndMethod:function(url,method){for(prop in app.rest.api)if(app.rest.api[prop].url==url&&app.rest.api[prop].method==method.toLowerCase()&&app.rest.api[prop].enabled)return!0;return!1},__execMockByUrl:function(url,method,request){for(prop in app.rest.api)if(app.rest.api[prop].url==url&&app.rest.api[prop].method==method.toLowerCase()&&app.rest.api[prop].enabled)return app.rest.api[prop].mockExec(request)},__execMockByName:function(name,method,request){for(prop in app.rest.api)if(prop==name&&app.rest.api[prop].method==method.toLowerCase()&&app.rest.api[prop].enabled)return app.rest.api[prop].mockExec(request)},__createCachedPromise:function(data,interceptors){var promise={result:data,then:function(callback){promise.result&&(data=promise.result);var _result=callback(data);return _result&&(promise.result=_result),promise},catch:function(){return promise}};return app.rest.__invokeInterceptors(data,promise,interceptors),promise},list:function(restObjectsList){$.each(restObjectsList,function(i,restObj){app.rest.register(restObj.name,restObj.url,restObj.method,restObj.mock.returning,restObj.mock.enabled)})},add:function(restName,restUrl,restMethod,mockReturningFunction,mockEnabled){this.register(restName,restUrl,restMethod,config,mockReturningFunction,mockEnabled)},register:function(restName,restUrl,restMethod,mockReturningFunction,mockEnabled){app.util.System.isNull(mockEnabled)&&(mockEnabled=!1);var urlVal=null;urlVal="string"==typeof restUrl?restUrl:restUrl(),restMethod=restMethod.toLowerCase(),app.rest.api[restName]={url:urlVal,method:restMethod,mockExec:mockReturningFunction,mockEnabled:mockEnabled,promise:app.rest.__getExecFunction(urlVal,restMethod)}},__getExecFunction:function(url,method){return"get"==method?function(config){return app.rest.get(url,config||{})}:"delete"==method?function(config){return app.rest.delete(url,config||{})}:"post"==method?function(request,config){return app.rest.post(url,request,config||{})}:"put"==method?function(request,config){return app.rest.put(url,request,config||{})}:void 0},get:function(urlOrCachedData,propertiesObject){return propertiesObject=propertiesObject||{},"string"==typeof urlOrCachedData?app.rest.__getDelete(urlOrCachedData,"GET",propertiesObject.pathParams,propertiesObject.headers,propertiesObject.urlParams,propertiesObject.interceptors||[]):this.__createCachedPromise(urlOrCachedData,propertiesObject.interceptors||[])},delete:function(urlOrCachedData,propertiesObject){return propertiesObject=propertiesObject||{},"string"==typeof urlOrCachedData?app.rest.__getDelete(urlOrCachedData,"DELETE",propertiesObject.pathParams,propertiesObject.headers,propertiesObject.urlParams,propertiesObject.interceptors||[]):this.__createCachedPromise(urlOrCachedData,propertiesObject.interceptors||[])},update:function(urlOrCachedData,request,propertiesObject){return propertiesObject=propertiesObject||{},"string"==typeof urlOrCachedData?app.rest.__postPut(urlOrCachedData,"PUT",request,propertiesObject.pathParams,propertiesObject.headers,propertiesObject.urlParams,propertiesObject.interceptors||[]):this.__createCachedPromise(urlOrCachedData,propertiesObject.interceptors||[])},post:function(urlOrCachedData,request,propertiesObject){return propertiesObject=propertiesObject||{},"string"==typeof urlOrCachedData?app.rest.__postPut(urlOrCachedData,"POST",request,propertiesObject.pathParams,propertiesObject.headers,propertiesObject.urlParams,propertiesObject.interceptors||[]):this.__createCachedPromise(urlOrCachedData,propertiesObject.interceptors||[])},__isMock:function(url,method,request,interceptors,callBackIsnt){var promise=null;if(app.rest.__isEnabledMockByUrlAndMethod(url,method)){var result=app.rest.__execMockByUrl(url,method,request);promise={result:result,then:function(callBack){var _result=callback(promise.result);return _result&&(promise.result=_result),callBack(promise.result),promise},catch:function(callBack){return promise}},app.rest.__invokeInterceptors(result,promise,interceptors)}else promise=callBackIsnt();return promise},__getDelete:function(url,method,pathParams,headers,urlParams,interceptors){return app.rest.__isMock(url,method,null,interceptors,function(){var preparedUrl=url;void 0!==pathParams&&null!==pathParams&&(preparedUrl=app.util.System.preparePathDottedParams(url,pathParams)),void 0!==urlParams&&null!==urlParams&&(preparedUrl=app.util.System.prepareUrlParams(url,urlParams));var dataType="json",contentType="application/json; charset=utf-8";headers&&headers["Content-Type"]&&(contentType=headers["Content-Type"]),headers&&headers.contentType&&(contentType=headers.contentType),headers&&headers.dataType&&(dataType=headers.dataType);var promise=$.ajax({url:preparedUrl,type:method,beforeSend:function(){app.rest.isSpinnerExcluded(url)||app.rest.spinnerShow(url)},complete:function(){app.rest.isSpinnerExcluded(url)||app.rest.spinnerHide(url)},headers:headers,contentType:contentType,dataType:dataType});return promise.result=null,promise.then=function(callback){return promise.done(function(result){promise.result&&(result=promise.result),app.rest.__invokeInterceptors(result,promise,interceptors);var _result=callback(result,promise);_result&&(promise.result=_result)}),promise},promise.catch=function(callback){return promise.fail(function(error){app.rest.__invokeInterceptors(error,promise,interceptors),callback(error,promise)}),promise},promise})},__postPut:function(url,method,request,pathParams,headers,urlParams,interceptors){return app.rest.__isMock(url,method,request,interceptors,function(){var jsonData=JSON.stringify(request),preparedUrl=url;void 0!==pathParams&&null!==pathParams&&(preparedUrl=app.util.System.preparePathDottedParams(url,pathParams)),void 0!==urlParams&&null!==urlParams&&(preparedUrl=app.util.System.prepareUrlParams(url,urlParams));var dataType="json",contentType="application/json; charset=utf-8";headers&&headers["Content-Type"]&&(contentType=headers["Content-Type"]),headers&&headers.contentType&&(contentType=headers.contentType),headers&&headers.dataType&&(dataType=headers.dataType);var promise=$.ajax({url:preparedUrl,data:jsonData,type:method,
beforeSend:function(){app.rest.isSpinnerExcluded(url)||app.rest.spinnerShow(url)},complete:function(){app.rest.isSpinnerExcluded(url)||app.rest.spinnerHide(url)},headers:headers,contentType:contentType,dataType:dataType});return promise.then=function(callback){return promise.done(function(result){promise.result&&(result=promise.result),app.rest.__invokeInterceptors(result,promise,interceptors);var _result=callback(result,promise);_result&&(promise.result=_result)}),promise},promise.catch=function(callback){return promise.fail(function(error){app.rest.__invokeInterceptors(error,promise,interceptors),callback(error,promise)}),promise},promise})}},jQuery.fn.extend({serializeObject:function(){for(var serializedArray=this.serializeArray(),serializedObject={},i=0;i<serializedArray.length;i++){var value=serializedArray[i].value;"on"==value?value=!0:"off"==value&&(value=!1),serializedObject[serializedArray[i].name]=value}return serializedObject}}),jQuery.fn.extend({set:function(_value,_filter){void 0!==_value&&null!=_value&&(_filter&&void 0!==_value&&null!==_value&&(_value=_filter(_value)),app.util.System.isObject(_value)?_spike_jquery_set_populateFunction($(this),_value):_spike_jquery_set_setFunction($(this),_value))}}),jQuery.fn.extend({attrs:function(){var attributesMap={};return jQuery.each(this[0].attributes,function(){this.specified&&(this.name=this.name.replace("data-",""),attributesMap[app.util.System.toCamelCase(this.name)]=this.value)}),attributesMap}}),app.config.extend({bootstrapModal:!1}),app.modal.implement("register",function(modalObject){app.config.bootstrapModal&&(modalObject.preventDismiss?modalObject.__preventDismiss=!0:modalObject.__preventDismiss=!1)}),app.modal.implement("render",function(modalSelector,modalObject){app.config.bootstrapModal&&(modalObject.__preventDismiss?modalSelector.modal({backdrop:"static",keyboard:!1}):app.config.bootstrapModal&&modalSelector.modal(),modalSelector.on("hidden.bs.modal",function(){modalObject.__hidden=!0}))}),app.modal.implement("show",function(modalSelector,modalObject,defaultImpl){app.config.bootstrapModal?modalSelector.modal("show"):defaultImpl(modalSelector)}),app.modal.implement("hide",function(modalSelector,modalObject,defaultImpl){app.config.bootstrapModal?(modalSelector.modal("hide"),$("body").removeClass("modal-open"),$("div.modal-backdrop").remove()):defaultImpl(modalSelector)});